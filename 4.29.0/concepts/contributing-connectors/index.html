
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://smallrye.io/smallrye-reactive-messaging/4.29.0/concepts/contributing-connectors/">
      
      
        <link rel="prev" href="../connectors/">
      
      
        <link rel="next" href="../acknowledgement/">
      
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>Contributing Connectors - SmallRye Reactive Messaging</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Red+Hat+Text:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Red Hat Text";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
      <link rel="stylesheet" href="../../css/smallrye.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#connector-contribution-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SmallRye Reactive Messaging" class="md-header__button md-logo" aria-label="SmallRye Reactive Messaging" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SmallRye Reactive Messaging
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Contributing Connectors
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/smallrye/smallrye-reactive-messaging" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SmallRye Reactive Messaging" class="md-nav__button md-logo" aria-label="SmallRye Reactive Messaging" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    SmallRye Reactive Messaging
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/smallrye/smallrye-reactive-messaging" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../emitter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emitters and Channel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../connectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connectors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Contributing Connectors
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Contributing Connectors
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementing-inbound-channels" class="md-nav__link">
    Implementing Inbound Channels
  </a>
  
    <nav class="md-nav" aria-label="Implementing Inbound Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connector-threading-and-vertx" class="md-nav__link">
    Connector Threading and Vert.x
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-message-and-metadata-implementations" class="md-nav__link">
    Custom Message and Metadata implementations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgment-strategies" class="md-nav__link">
    Acknowledgment strategies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failure-handling-strategies" class="md-nav__link">
    Failure handling strategies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-converters" class="md-nav__link">
    Message Converters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-outbound-channels" class="md-nav__link">
    Implementing Outbound Channels
  </a>
  
    <nav class="md-nav" aria-label="Implementing Outbound Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#outgoing-message-builder" class="md-nav__link">
    Outgoing Message Builder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outgoing-message-acknowledgement" class="md-nav__link">
    Outgoing message acknowledgement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smallrye-health-integration" class="md-nav__link">
    Smallrye Health Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-tracing-integration" class="md-nav__link">
    OpenTelemetry Tracing Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-connector" class="md-nav__link">
    Testing the connector
  </a>
  
    <nav class="md-nav" aria-label="Testing the connector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-tests-for-validating-the-connector" class="md-nav__link">
    Common tests for validating the connector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../acknowledgement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../blocking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blocking Processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../signatures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Method Signatures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../skipping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Skipping Messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../converters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Message Converters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../keyed-multi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keyed Streams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Channel Decorators and Interceptors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../broadcast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Broadcast
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../merge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merge channels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../incoming-concurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Incoming Channel Concurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../incomings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    @Incomings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../outgoings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    @Outgoings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Observability API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../advanced-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../message-context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Message Context
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../incoming-metadata-injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata Injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../generic-payloads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generic Payloads
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../pausable-channels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pausable Channels
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Kafka
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Kafka
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/kafka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Kafka Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/receiving-kafka-records/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving records
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/writing-kafka-records/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing records
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/health/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Health Checks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/avro-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Avro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/protobuf-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Protobuf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/consumer-rebalance-listener/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rebalance Listeners
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/kerberos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/client-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accessing the client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/default-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing Default Kafka Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/test-companion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Companion for Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/transactions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka Transactions and Exactly-Once Processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/request-reply/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka Request/Reply
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AMQP 1.0
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            AMQP 1.0
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../amqp/amqp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMQP 1.0 Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../amqp/receiving-amqp-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../amqp/sending-amqp-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../amqp/health/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Health Checks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../amqp/client-customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client Customization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../amqp/rabbitmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using RabbitMQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    RabbitMQ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            RabbitMQ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rabbitmq/rabbitmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RabbitMQ Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rabbitmq/receiving-messages-from-rabbitmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rabbitmq/sending-messages-to-rabbitmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rabbitmq/rabbitmq-health/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Health Checks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rabbitmq/rabbitmq-client-customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client Customization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../rabbitmq/rabbitmq-cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connecting to managed instances
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Pulsar
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Pulsar
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/pulsar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Pulsar Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/receiving-pulsar-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/sending-messages-to-pulsar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/schema-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring the Schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/client-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring the Pulsar client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/health/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Health Checks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/client-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accessing the client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pulsar/transactions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulsar Transactions and Exactly-Once Processing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Apache Camel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Apache Camel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../camel/camel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Camel Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../camel/receiving-messages-from-camel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving messages from Camel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../camel/sending-messages-to-camel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending messages to Camel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../camel/camel-processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementing Camel processor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../camel/using-existing-routes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using existing Camel routes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    JMS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            JMS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jms/jms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The JMS connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jms/receiving-jms-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving JMS messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jms/sending-jms-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending JMS messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../jms/advanced-jms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    MQTT
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            MQTT
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mqtt/mqtt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MQTT Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mqtt/receiving-mqtt-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving MQTT messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mqtt/sending-messages-to-mqtt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending MQTT messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mqtt/client-customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing the MQTT client
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AWS SQS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            AWS SQS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../sqs/sqs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS SQS Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../sqs/receiving-aws-sqs-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Receiving AWS SQS messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../sqs/sending-aws-sqs-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending AWS SQS messages
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AWS SNS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            AWS SNS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../sns/sns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS SNS Connector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../sns/sending-aws-sns-messages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sending AWS SNS messages
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementing-inbound-channels" class="md-nav__link">
    Implementing Inbound Channels
  </a>
  
    <nav class="md-nav" aria-label="Implementing Inbound Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connector-threading-and-vertx" class="md-nav__link">
    Connector Threading and Vert.x
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-message-and-metadata-implementations" class="md-nav__link">
    Custom Message and Metadata implementations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgment-strategies" class="md-nav__link">
    Acknowledgment strategies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failure-handling-strategies" class="md-nav__link">
    Failure handling strategies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-converters" class="md-nav__link">
    Message Converters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-outbound-channels" class="md-nav__link">
    Implementing Outbound Channels
  </a>
  
    <nav class="md-nav" aria-label="Implementing Outbound Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#outgoing-message-builder" class="md-nav__link">
    Outgoing Message Builder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outgoing-message-acknowledgement" class="md-nav__link">
    Outgoing message acknowledgement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smallrye-health-integration" class="md-nav__link">
    Smallrye Health Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-tracing-integration" class="md-nav__link">
    OpenTelemetry Tracing Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-connector" class="md-nav__link">
    Testing the connector
  </a>
  
    <nav class="md-nav" aria-label="Testing the connector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-tests-for-validating-the-connector" class="md-nav__link">
    Common tests for validating the connector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="connector-contribution-guide">Connector Contribution Guide</h1>
<p>A connector implementation is a CDI-managed bean, typically an <code>@ApplicationScoped</code> bean,
which is identified by the <code>@Connector</code> identifier.
In order to provide inbound and outbound channels, the connector implements two interfaces <code>InboundConnector</code> and <code>OutboundConnector</code> respectively.
In addition to that, the connector bean is annotated with <code>@ConnectorAttribute</code>, which describes attributes to configure channels.</p>
<div class="admonition abstract">
<p class="admonition-title">Maven Archetype</p>
<p>Smallrye Reactive Messaging provides a Maven archetype to bootstrap a new connector.
You can generate a new connector project with the code described in this guide using:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span>
<span class="normal"><a href="#__codelineno-0-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>mvn<span class="w"> </span>-N<span class="w"> </span>archetype:generate<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>-DarchetypeGroupId<span class="o">=</span>io.smallrye.reactive<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>-DarchetypeArtifactId<span class="o">=</span>smallrye-reactive-messaging-connector-archetype<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>-DarchetypeVersion<span class="o">=</span><span class="m">4</span>.29.0<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>-DgroupId<span class="o">=</span>io.smallrye.reactive<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>-Dpackage<span class="o">=</span>io.smallrye.reactive.messaging.my<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>-Dversion<span class="o">=</span><span class="m">4</span>.29.0<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>-DartifactId<span class="o">=</span>smallrye-reactive-messaging-my<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>-DconnectorName<span class="o">=</span>my
</code></pre></div></td></tr></table></div></p>
</div>
<p>The following is an example of a connector skeleton :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span>
<span class="normal"><a href="#__codelineno-1-59">59</a></span>
<span class="normal"><a href="#__codelineno-1-60">60</a></span>
<span class="normal"><a href="#__codelineno-1-61">61</a></span>
<span class="normal"><a href="#__codelineno-1-62">62</a></span>
<span class="normal"><a href="#__codelineno-1-63">63</a></span>
<span class="normal"><a href="#__codelineno-1-64">64</a></span>
<span class="normal"><a href="#__codelineno-1-65">65</a></span>
<span class="normal"><a href="#__codelineno-1-66">66</a></span>
<span class="normal"><a href="#__codelineno-1-67">67</a></span>
<span class="normal"><a href="#__codelineno-1-68">68</a></span>
<span class="normal"><a href="#__codelineno-1-69">69</a></span>
<span class="normal"><a href="#__codelineno-1-70">70</a></span>
<span class="normal"><a href="#__codelineno-1-71">71</a></span>
<span class="normal"><a href="#__codelineno-1-72">72</a></span>
<span class="normal"><a href="#__codelineno-1-73">73</a></span>
<span class="normal"><a href="#__codelineno-1-74">74</a></span>
<span class="normal"><a href="#__codelineno-1-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.annotations.ConnectorAttribute.Direction.INCOMING</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.annotations.ConnectorAttribute.Direction.INCOMING_AND_OUTGOING</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.annotations.ConnectorAttribute.Direction.OUTGOING</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CopyOnWriteArrayList</span><span class="p">;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.Flow</span><span class="p">;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.annotation.PostConstruct</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.config.Config</span><span class="p">;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Message</span><span class="p">;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.spi.Connector</span><span class="p">;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.BrokerClient</span><span class="p">;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.annotations.ConnectorAttribute</span><span class="p">;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.connector.InboundConnector</span><span class="p">;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.connector.OutboundConnector</span><span class="p">;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.connectors.ExecutionHolder</span><span class="p">;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.vertx.mutiny.core.Vertx</span><span class="p">;</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="nd">@ApplicationScoped</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="nd">@Connector</span><span class="p">(</span><span class="n">MyConnector</span><span class="p">.</span><span class="na">CONNECTOR_NAME</span><span class="p">)</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="nd">@ConnectorAttribute</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;client-id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INCOMING_AND_OUTGOING</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The client id &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="nd">@ConnectorAttribute</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;buffer-size&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INCOMING</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The size buffer of incoming messages waiting to be processed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;128&quot;</span><span class="p">)</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="nd">@ConnectorAttribute</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OUTGOING</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The default topic to send the messages, defaults to channel name if not set&quot;</span><span class="p">)</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="nd">@ConnectorAttribute</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;maxPendingMessages&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OUTGOING</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The maximum size of a queue holding pending messages&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1000&quot;</span><span class="p">)</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="nd">@ConnectorAttribute</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;waitForWriteCompletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OUTGOING</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Whether the outgoing channel waits for the write completion&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyConnector</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">InboundConnector</span><span class="p">,</span><span class="w"> </span><span class="n">OutboundConnector</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">CONNECTOR_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;smallrye-my-connector&quot;</span><span class="p">;</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">    </span><span class="nd">@Inject</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">    </span><span class="n">ExecutionHolder</span><span class="w"> </span><span class="n">executionHolder</span><span class="p">;</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="w">    </span><span class="n">Vertx</span><span class="w"> </span><span class="n">vertx</span><span class="p">;</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MyIncomingChannel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">incomingChannels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MyOutgoingChannel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">outgoingChannels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="w">    </span><span class="nd">@PostConstruct</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">vertx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executionHolder</span><span class="p">.</span><span class="na">vertx</span><span class="p">();</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flow</span><span class="p">.</span><span class="na">Publisher</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">getPublisher</span><span class="p">(</span><span class="n">Config</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="w">        </span><span class="n">MyConnectorIncomingConfiguration</span><span class="w"> </span><span class="n">ic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyConnectorIncomingConfiguration</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">channelName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ic</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">clientId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ic</span><span class="p">.</span><span class="na">getClientId</span><span class="p">();</span>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ic</span><span class="p">.</span><span class="na">getBufferSize</span><span class="p">();</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="w">        </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BrokerClient</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">clientId</span><span class="p">);</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a><span class="w">        </span><span class="n">MyIncomingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyIncomingChannel</span><span class="p">(</span><span class="n">vertx</span><span class="p">,</span><span class="w"> </span><span class="n">ic</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="p">);</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="w">        </span><span class="n">incomingChannels</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">channel</span><span class="p">.</span><span class="na">getStream</span><span class="p">();</span>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flow</span><span class="p">.</span><span class="na">Subscriber</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">getSubscriber</span><span class="p">(</span><span class="n">Config</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-65" name="__codelineno-1-65"></a><span class="w">        </span><span class="n">MyConnectorOutgoingConfiguration</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyConnectorOutgoingConfiguration</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<a id="__codelineno-1-66" name="__codelineno-1-66"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">channelName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oc</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>
<a id="__codelineno-1-67" name="__codelineno-1-67"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">clientId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oc</span><span class="p">.</span><span class="na">getClientId</span><span class="p">();</span>
<a id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pendingMessages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oc</span><span class="p">.</span><span class="na">getMaxPendingMessages</span><span class="p">();</span>
<a id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="w">        </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BrokerClient</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">clientId</span><span class="p">);</span>
<a id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="w">        </span><span class="n">MyOutgoingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyOutgoingChannel</span><span class="p">(</span><span class="n">vertx</span><span class="p">,</span><span class="w"> </span><span class="n">oc</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="p">);</span>
<a id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="w">        </span><span class="n">outgoingChannels</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
<a id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">channel</span><span class="p">.</span><span class="na">getSubscriber</span><span class="p">();</span>
<a id="__codelineno-1-74" name="__codelineno-1-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-75" name="__codelineno-1-75"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Note that the <code>getPublisher</code> and <code>getSubscriber</code> methods receive MicroProfile Config <code>Config</code> instance and wrap it with
<code>MyConnectorIncomingConfiguration</code> and <code>MyConnectorOutgoingConfiguration</code> objects.</p>
<p>These custom channel configuration types ease getting channel configuration, including the optional or default values.
They are generated by the <code>smallrye-connector-attribute-processor</code> annotation processor, and can be configured in project pom like the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">      </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>smallrye-reactive-messaging-provider<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">      </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">      </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>io.smallrye.reactive<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>smallrye-connector-attribute-processor<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">      </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="nt">&lt;build&gt;</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">      </span><span class="nt">&lt;plugins&gt;</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">        </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">          </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">          </span><span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">          </span><span class="nt">&lt;configuration&gt;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">            </span><span class="nt">&lt;generatedSourcesDirectory&gt;</span>${project.build.directory}/generated-sources/<span class="nt">&lt;/generatedSourcesDirectory&gt;</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">            </span><span class="nt">&lt;annotationProcessors&gt;</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">              </span><span class="nt">&lt;annotationProcessor&gt;</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">                </span>io.smallrye.reactive.messaging.connector.ConnectorAttributeProcessor
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">              </span><span class="nt">&lt;/annotationProcessor&gt;</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">              </span><span class="nt">&lt;annotationProcessor&gt;</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">                </span>org.jboss.logging.processor.apt.LoggingToolsProcessor
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">              </span><span class="nt">&lt;/annotationProcessor&gt;</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">            </span><span class="nt">&lt;/annotationProcessors&gt;</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">          </span><span class="nt">&lt;/configuration&gt;</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">        </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="w">      </span><span class="nt">&lt;/plugins&gt;</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">    </span><span class="nt">&lt;/build&gt;</span>
</code></pre></div></td></tr></table></div>
<p>The <code>smallrye-reactive-messaging-provider</code> is the minimum required dependency for a connector implementation.
You'll also note that the <code>LoggingToolsProcessor</code> annotation processor is also configured.
This enables generating internationalized log statements and exceptions.
Typically, you would create following interfaces in <code>i18n</code> sub-package: <code>[Connector]Exceptions</code>, <code>[Connector]Logging</code> and <code>[Connector]Messages</code>.
More information can be found in <a href="https://jboss-logging.github.io/jboss-logging-tools/">JBoss Logging Tools documentation</a>.</p>
<h2 id="implementing-inbound-channels">Implementing Inbound Channels</h2>
<p>The <code>InboundConnector</code> implementation returns, for a given channel configuration, a reactive stream of <code>Message</code>s.
The returned reactive stream is an instance of <code>Flow.Publisher</code> and typically can be implemented using Mutiny <code>Multi</code> type.</p>
<div class="admonition note">
<p class="admonition-title"><code>IncomingConnectorFactory</code></p>
<p>The inbound channels can also implement the <code>IncomingConnectorFactory</code> from the MicroProfile Reactive Messaging specification.
However, the <code>PublisherBuilder</code> type can be more challenging to work with and
Smallrye Reactive Messaging converts the provided stream to Mutiny types to do the wiring anyway.</p>
</div>
<p>The returned <code>Flow.Publisher</code> would allow controlling the flow of ingestion using backpressure.
It would be preferable to use pull-based APIs of the underlying messaging library to receive messages from the message broker.
You can refer to the <a href="https://smallrye.io/smallrye-mutiny/latest/guides/polling/"><code>Mutiny</code> "How to use polling?" guide</a>
to construct a <code>Multi</code> using Mutiny APIs, or implement the <code>Flow.Subscription</code> from scratch and wrap it in an <code>AbstractMulti</code>.</p>
<p>Here is an example channel implementation which constructs the reactive stream using the polling API:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span>
<span class="normal"><a href="#__codelineno-3-35">35</a></span>
<span class="normal"><a href="#__codelineno-3-36">36</a></span>
<span class="normal"><a href="#__codelineno-3-37">37</a></span>
<span class="normal"><a href="#__codelineno-3-38">38</a></span>
<span class="normal"><a href="#__codelineno-3-39">39</a></span>
<span class="normal"><a href="#__codelineno-3-40">40</a></span>
<span class="normal"><a href="#__codelineno-3-41">41</a></span>
<span class="normal"><a href="#__codelineno-3-42">42</a></span>
<span class="normal"><a href="#__codelineno-3-43">43</a></span>
<span class="normal"><a href="#__codelineno-3-44">44</a></span>
<span class="normal"><a href="#__codelineno-3-45">45</a></span>
<span class="normal"><a href="#__codelineno-3-46">46</a></span>
<span class="normal"><a href="#__codelineno-3-47">47</a></span>
<span class="normal"><a href="#__codelineno-3-48">48</a></span>
<span class="normal"><a href="#__codelineno-3-49">49</a></span>
<span class="normal"><a href="#__codelineno-3-50">50</a></span>
<span class="normal"><a href="#__codelineno-3-51">51</a></span>
<span class="normal"><a href="#__codelineno-3-52">52</a></span>
<span class="normal"><a href="#__codelineno-3-53">53</a></span>
<span class="normal"><a href="#__codelineno-3-54">54</a></span>
<span class="normal"><a href="#__codelineno-3-55">55</a></span>
<span class="normal"><a href="#__codelineno-3-56">56</a></span>
<span class="normal"><a href="#__codelineno-3-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.Flow</span><span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.atomic.AtomicBoolean</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Message</span><span class="p">;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.BrokerClient</span><span class="p">;</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Multi</span><span class="p">;</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Uni</span><span class="p">;</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.health.HealthReport</span><span class="p">;</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.vertx.core.impl.VertxInternal</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.vertx.mutiny.core.Context</span><span class="p">;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.vertx.mutiny.core.Vertx</span><span class="p">;</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyIncomingChannel</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">channel</span><span class="p">;</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MyAckHandler</span><span class="w"> </span><span class="n">ackHandler</span><span class="p">;</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MyFailureHandler</span><span class="w"> </span><span class="n">failureHandler</span><span class="p">;</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="w"> </span><span class="n">closed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AtomicBoolean</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Flow</span><span class="p">.</span><span class="na">Publisher</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">stream</span><span class="p">;</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyIncomingChannel</span><span class="p">(</span><span class="n">Vertx</span><span class="w"> </span><span class="n">vertx</span><span class="p">,</span><span class="w"> </span><span class="n">MyConnectorIncomingConfiguration</span><span class="w"> </span><span class="n">cfg</span><span class="p">,</span><span class="w"> </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">        </span><span class="c1">// create and configure the client with MyConnectorIncomingConfiguration</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cfg</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(((</span><span class="n">VertxInternal</span><span class="p">)</span><span class="w"> </span><span class="n">vertx</span><span class="p">.</span><span class="na">getDelegate</span><span class="p">()).</span><span class="na">createEventLoopContext</span><span class="p">());</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">ackHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyAckHandler</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="p">);</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">failureHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyFailureHandler</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="p">);</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Multi</span><span class="p">.</span><span class="na">createBy</span><span class="p">().</span><span class="na">repeating</span><span class="p">()</span>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">                </span><span class="p">.</span><span class="na">uni</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="p">.</span><span class="na">poll</span><span class="p">()))</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="w">                </span><span class="p">.</span><span class="na">until</span><span class="p">(</span><span class="n">__</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">closed</span><span class="p">.</span><span class="na">get</span><span class="p">())</span>
<a id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="w">                </span><span class="p">.</span><span class="na">emitOn</span><span class="p">(</span><span class="n">context</span><span class="p">::</span><span class="n">runOnContext</span><span class="p">)</span>
<a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">consumed</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyMessage</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">consumed</span><span class="p">,</span><span class="w"> </span><span class="n">ackHandler</span><span class="p">,</span><span class="w"> </span><span class="n">failureHandler</span><span class="p">));</span>
<a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-39" name="__codelineno-3-39"></a>
<a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getChannel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">channel</span><span class="p">;</span>
<a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-43" name="__codelineno-3-43"></a>
<a id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flow</span><span class="p">.</span><span class="na">Publisher</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">getStream</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">stream</span><span class="p">;</span>
<a id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-47" name="__codelineno-3-47"></a>
<a id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="w">        </span><span class="n">closed</span><span class="p">.</span><span class="na">compareAndSet</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="w">        </span><span class="n">client</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-3-51" name="__codelineno-3-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-52" name="__codelineno-3-52"></a>
<a id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">isReady</span><span class="p">(</span><span class="n">HealthReport</span><span class="p">.</span><span class="na">HealthReportBuilder</span><span class="w"> </span><span class="n">healthReportBuilder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-54" name="__codelineno-3-54"></a>
<a id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-56" name="__codelineno-3-56"></a>
<a id="__codelineno-3-57" name="__codelineno-3-57"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="connector-threading-and-vertx">Connector Threading and Vert.x</h3>
<p>Whether the external API call is blocking or non-blocking, managing the thread on which the message processing will be dispatched can be challenging.
Smallrye Reactive Messaging depends on <a href="https://vertx.io/">Eclipse Vert.x</a> to consistently dispatch messages in event-loop or worker threads,
propagating the message context along different processing stages.
You can read more on <a href="../message-context/">Message Context</a> and <a href="https://vertx.io/blog/an-introduction-to-the-vert-x-context-object/">Vert.x Context</a>.</p>
<p>Some connectors already use Vert.x clients, such as RabbitMQ, AMQP 1.0 or MQTT.
Other connectors such as Kafka or Pulsar directly use the client library of the messaging technology,
therefore they create a Vert.x Context per channel to dispatch messages on that context.
Connectors can access the <code>Vertx</code> instance by injecting the <code>ExecutionHolder</code> bean.
<a href="https://smallrye.io/smallrye-mutiny/latest/guides/emit-on-vs-run-subscription-on/">Mutiny operators <code>runSubscribtionOn</code> and <code>emitOn</code></a> can be used to switch threads the events are dispatched on.</p>
<h3 id="custom-message-and-metadata-implementations">Custom Message and Metadata implementations</h3>
<p>Reactive messaging <a class='docissimo, docissimo-javadoc' href='https://javadoc.io/doc/io.smallrye.reactive/smallrye-reactive-messaging-api/4.29.0/org/eclipse/microprofile/reactive/messaging/Message.html'>Message</a>
type is a thin wrapper around a payload and some metadata, which lets implementing acknowledgment and negative acknowledgment of that message.</p>
<p>Messages received from the underlying library very often return with a custom type,
wrapping the payload and some properties such as key, timestamp, schema information, or any other metadata.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The client may propose different strategies for consuming messages individually or in batches.
If a batch consuming is available the incoming channel may receive wrap and dispatch message as a batch or individually.</p>
</div>
<p>While it is possible to use <code>Message.of</code> builder methods to wrap the incoming message type,
a custom type implementing <code>Message</code> interface helps to deal with different aspects we'll cover later,
such as deserialization, message acknowledgment or tracing.</p>
<p>An example message implementation would be like the following:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span>
<span class="normal"><a href="#__codelineno-4-38">38</a></span>
<span class="normal"><a href="#__codelineno-4-39">39</a></span>
<span class="normal"><a href="#__codelineno-4-40">40</a></span>
<span class="normal"><a href="#__codelineno-4-41">41</a></span>
<span class="normal"><a href="#__codelineno-4-42">42</a></span>
<span class="normal"><a href="#__codelineno-4-43">43</a></span>
<span class="normal"><a href="#__codelineno-4-44">44</a></span>
<span class="normal"><a href="#__codelineno-4-45">45</a></span>
<span class="normal"><a href="#__codelineno-4-46">46</a></span>
<span class="normal"><a href="#__codelineno-4-47">47</a></span>
<span class="normal"><a href="#__codelineno-4-48">48</a></span>
<span class="normal"><a href="#__codelineno-4-49">49</a></span>
<span class="normal"><a href="#__codelineno-4-50">50</a></span>
<span class="normal"><a href="#__codelineno-4-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletionStage</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Message</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Metadata</span><span class="p">;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.ConsumedMessage</span><span class="p">;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.locals.ContextAwareMessage</span><span class="p">;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">ContextAwareMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="n">metadata</span><span class="p">;</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MyAckHandler</span><span class="w"> </span><span class="n">ackHandler</span><span class="p">;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MyFailureHandler</span><span class="w"> </span><span class="n">nackHandler</span><span class="p">;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ConsumedMessage</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">consumed</span><span class="p">;</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyMessage</span><span class="p">(</span><span class="n">ConsumedMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">MyAckHandler</span><span class="w"> </span><span class="n">ackHandler</span><span class="p">,</span><span class="w"> </span><span class="n">MyFailureHandler</span><span class="w"> </span><span class="n">nackHandler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">consumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">body</span><span class="p">();</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">ackHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ackHandler</span><span class="p">;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nackHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nackHandler</span><span class="p">;</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContextAwareMessage</span><span class="p">.</span><span class="na">captureContextMetadata</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyIncomingMetadata</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">message</span><span class="p">));</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ConsumedMessage</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">getConsumedMessage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">consumed</span><span class="p">;</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getPayload</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="nf">getMetadata</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">metadata</span><span class="p">;</span>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-41" name="__codelineno-4-41"></a>
<a id="__codelineno-4-42" name="__codelineno-4-42"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-4-43" name="__codelineno-4-43"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">ack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-44" name="__codelineno-4-44"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ackHandler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-4-45" name="__codelineno-4-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-46" name="__codelineno-4-46"></a>
<a id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">nack</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="n">nackMetadata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">nackHandler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">nackMetadata</span><span class="p">);</span>
<a id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-51" name="__codelineno-4-51"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>Note that <code>MyMessage</code> implements the <code>ContextAwareMessage</code>.
In the constructor <code>captureContextMetadata</code> helper method is used to capture the Vert.x context which created the object and capturing it into the <code>LocalContextMetadata</code>.
This metadata allows running <a href="../message-context/">each message in its own Vert.x context, supporting context propagation</a>.</p>
<p>The <code>MyMessage</code> type implements the accessors for the <code>metadata</code> and <code>payload</code> from the <code>Message</code> interface.
If the messaging technology doesn't have a built-in unmarshalling mechanism, the message can deserialize the raw payload to a primitive or a complex object.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The custom message implementation is usually not the type consumed by the application injecting channels.
Applications usually inject in the payload, the raw consumed type (in the above example the <code>ConsumedMessage</code>),
or some other type provided by the <a href="../converters/"><code>MessageConverter</code>s</a>.
Handling of <code>Message</code> types by the application is restricted only to advanced use cases, because handling of message acknowledgment is manual
Even then the message may be intercepted before and changed, conserving the <code>metadata</code>, <code>ack</code> and <code>nack</code> handlers but not the original type created by the connector.</p>
</div>
<p>The <code>MyIncomingMetadata</code> gives access to the underlying consumed message attributes, and applications can inject this object for accessing message details:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.ConsumedMessage</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyIncomingMetadata</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ConsumedMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyIncomingMetadata</span><span class="p">(</span><span class="n">ConsumedMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ConsumedMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getCustomMessage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getBody</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">body</span><span class="p">();</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">key</span><span class="p">();</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">getTimestamp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">timestamp</span><span class="p">();</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getProperties</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">properties</span><span class="p">();</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>Also note that <code>ack</code> and <code>nack</code> method implementations are delegated to handler objects.
This allows configuring different strategies at channel level.</p>
<h3 id="acknowledgment-strategies">Acknowledgment strategies</h3>
<p>The <a href="../acknowledgement/">acknowledgement</a> is the way for message consumers to inform the broker that the message has been successfully received and processed.
Depending on the messaging technology the broker then can decide to remove the message from the queue, flag as consumed or purge it completely.
In Reactive Messaging there are different policies to trigger the acknowledgement but the canonical one is to acknowledge a message when the processing (potentially asynchronous) has completed (<code>POST_PROCESSING</code>).</p>
<p>The Reactive Messaging defines <code>Message#ack</code> method as non-blocking asynchronous, returning a <code>CompletionStage&lt;Void&gt;</code>,
because potentially the acknowledgement action sends a network call to the broker.</p>
<p>The following example simply calls the client <code>ack</code> method using the Mutiny <code>Uni</code> and switch the emitter to the Message context.
Returning back to the message context is essential for chaining asynchronous actions without losing the context and for keeping the consistency on message consumption flow.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletionStage</span><span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.BrokerClient</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Uni</span><span class="p">;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyAckHandler</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">MyAckHandler</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyAckHandler</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyAckHandler</span><span class="p">(</span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">MyMessage</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="na">ack</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">getConsumedMessage</span><span class="p">()))</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">                </span><span class="p">.</span><span class="na">emitOn</span><span class="p">(</span><span class="n">msg</span><span class="p">::</span><span class="n">runOnMessageContext</span><span class="p">)</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">                </span><span class="p">.</span><span class="na">subscribeAsCompletionStage</span><span class="p">();</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>While this ack handler strategy acknowledges each message to the broker,
the messaging technology can allow employing different strategies for acknowledging messages.
For example an ack strategy can track processed messages and acknowledge them altogether or call a different client side endpoint to acknowledge the message batch.</p>
<h3 id="failure-handling-strategies">Failure handling strategies</h3>
<p>The failure handling, or the <a href="../acknowledgement/#negative-acknowledgement">negative acknowledgment</a> allows indicating that a message was not processed correctly.
Similar to the acknowledgment the Reactive Messaging defines <code>Message#nack(Throwable reason, Metadata metadata)</code> method as non-blocking asynchronous, returning a <code>CompletionStage&lt;Void&gt;</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletionStage</span><span class="p">;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Metadata</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.BrokerClient</span><span class="p">;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Uni</span><span class="p">;</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyFailureHandler</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">MyFailureHandler</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyFailureHandler</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyFailureHandler</span><span class="p">(</span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">MyMessage</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="n">metadata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">reject</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">getConsumedMessage</span><span class="p">(),</span><span class="w"> </span><span class="n">reason</span><span class="p">.</span><span class="na">getMessage</span><span class="p">()))</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">                </span><span class="p">.</span><span class="na">emitOn</span><span class="p">(</span><span class="n">msg</span><span class="p">::</span><span class="n">runOnMessageContext</span><span class="p">)</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">                </span><span class="p">.</span><span class="na">subscribeAsCompletionStage</span><span class="p">();</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Different failure handling strategies can, for example,
- Ignore the failure, log and call the <code>ack</code> instead
- Send the message to a dead letter queue and call the <code>ack</code>
- Employ a different strategy depending on the <code>Metadata</code> associated with the <code>nack</code> method call.</p>
<h3 id="message-converters">Message Converters</h3>
<p>The connector can propose default <a href="../converters/"><code>MessageConverter</code></a> implementations for converting the payload to a custom type.
As an example the following converter extracts the <code>CustomMessage</code> and puts it in the payload:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Type</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Message</span><span class="p">;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.ConsumedMessage</span><span class="p">;</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.MessageConverter</span><span class="p">;</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.helpers.TypeUtils</span><span class="p">;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="nd">@ApplicationScoped</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyMessageConverter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MessageConverter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">canConvert</span><span class="p">(</span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TypeUtils</span><span class="p">.</span><span class="na">isAssignable</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">ConsumedMessage</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="w">                </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">in</span><span class="p">.</span><span class="na">getMetadata</span><span class="p">(</span><span class="n">MyIncomingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">convert</span><span class="p">(</span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">in</span><span class="p">.</span><span class="na">withPayload</span><span class="p">(</span><span class="n">in</span><span class="p">.</span><span class="na">getMetadata</span><span class="p">(</span><span class="n">MyIncomingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">MyIncomingMetadata</span><span class="p">::</span><span class="n">getCustomMessage</span><span class="p">)</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="w">                </span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">));</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="implementing-outbound-channels">Implementing Outbound Channels</h2>
<p>The <code>OutboundConnector</code> implementation returns, for a given channel configuration, a <code>Flow.Subscriber</code> of messages.
This is typically implemented by a custom <code>Flow.Processor</code> and using the <code>MultiUtils.via</code> helper methods to apply message transformations.</p>
<div class="admonition note">
<p class="admonition-title"><code>OutgoingConnectorFactory</code></p>
<p>The outbound channels can also implement the <code>OutgoingConnectorFactory</code> from the MicroProfile Reactive Messaging specification.
However, it is usually more friendly to work with the <code>MultiUtils.via</code> methods to construct and transform outgoing messages.</p>
</div>
<p>Here is an example outgoing channel implementation:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.Flow</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Message</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.BrokerClient</span><span class="p">;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.api.SendMessage</span><span class="p">;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Uni</span><span class="p">;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.helpers.MultiUtils</span><span class="p">;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.vertx.mutiny.core.Vertx</span><span class="p">;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyOutgoingChannel</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">channel</span><span class="p">;</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Flow</span><span class="p">.</span><span class="na">Subscriber</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">subscriber</span><span class="p">;</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyOutgoingChannel</span><span class="p">(</span><span class="n">Vertx</span><span class="w"> </span><span class="n">vertx</span><span class="p">,</span><span class="w"> </span><span class="n">MyConnectorOutgoingConfiguration</span><span class="w"> </span><span class="n">oc</span><span class="p">,</span><span class="w"> </span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oc</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">;</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oc</span><span class="p">.</span><span class="na">getTopic</span><span class="p">().</span><span class="na">orElse</span><span class="p">(</span><span class="n">oc</span><span class="p">.</span><span class="na">getChannel</span><span class="p">());</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">subscriber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MultiUtils</span><span class="p">.</span><span class="na">via</span><span class="p">(</span><span class="n">multi</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">multi</span><span class="p">.</span><span class="na">call</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">publishMessage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)));</span>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">publishMessage</span><span class="p">(</span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="w">        </span><span class="c1">// construct the outgoing message</span>
<a id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="w">        </span><span class="n">SendMessage</span><span class="w"> </span><span class="n">sendMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SendMessage</span><span class="p">();</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">getPayload</span><span class="p">();</span>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setPayload</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
<a id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setTopic</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<a id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="w">        </span><span class="n">m</span><span class="p">.</span><span class="na">getMetadata</span><span class="p">(</span><span class="n">MyOutgoingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="w">            </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setTopic</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="na">getTopic</span><span class="p">());</span>
<a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="w">            </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setKey</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="na">getKey</span><span class="p">());</span>
<a id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="w">            </span><span class="c1">//...</span>
<a id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">sendMessage</span><span class="p">))</span>
<a id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="w">                </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">transformToUni</span><span class="p">(</span><span class="n">receipt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="na">ack</span><span class="p">()))</span>
<a id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="w">                </span><span class="p">.</span><span class="na">onFailure</span><span class="p">().</span><span class="na">recoverWithUni</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="na">nack</span><span class="p">(</span><span class="n">t</span><span class="p">)));</span>
<a id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-41" name="__codelineno-9-41"></a>
<a id="__codelineno-9-42" name="__codelineno-9-42"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flow</span><span class="p">.</span><span class="na">Subscriber</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">getSubscriber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">subscriber</span><span class="p">;</span>
<a id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-45" name="__codelineno-9-45"></a>
<a id="__codelineno-9-46" name="__codelineno-9-46"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getChannel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">channel</span><span class="p">;</span>
<a id="__codelineno-9-48" name="__codelineno-9-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-49" name="__codelineno-9-49"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
The <code>MultiUtils.via</code> helper method allows using the <code>Multi</code> chaining methods and in the same time provides a <code>Flow.Subscriber</code>.
However, this implementation allows sending messages one at a time:
one only after the previous outgoing message send is completed.</p>
<p>Some messaging technologies provide publish receipt,
a message back from the broker to the sender that asynchronously acknowledges the sent operation.
In this case the connector can only be sure of the send operation when it receives the publish receipt of that message.
Some technologies may provide blocking sending calls,
in that case the connector needs to delegate the sending call to a worker thread.</p>
<p>Depending on whether the client supports multiple in-flight outgoing messages, you can also use a <code>SenderProcessor</code>,
which allows receiving configuration for the maximum number of in-flight messages and whether it waits for completion (publish receipt from the broker):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span>
<span class="normal"><a href="#__codelineno-10-8">8</a></span>
<span class="normal"><a href="#__codelineno-10-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kt">long</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oc</span><span class="p">.</span><span class="na">getMaxPendingMessages</span><span class="p">();</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="kt">boolean</span><span class="w"> </span><span class="n">waitForWriteCompletion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oc</span><span class="p">.</span><span class="na">getWaitForWriteCompletion</span><span class="p">();</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">requests</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="n">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Long</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="p">}</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="k">this</span><span class="p">.</span><span class="na">processor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SenderProcessor</span><span class="p">(</span><span class="n">requests</span><span class="p">,</span><span class="w"> </span><span class="n">waitForWriteCompletion</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">publishMessage</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">));</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="k">this</span><span class="p">.</span><span class="na">subscriber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MultiUtils</span><span class="p">.</span><span class="na">via</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="na">onFailure</span><span class="p">().</span><span class="na">invoke</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="c1">// log the failure</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="p">}));</span>
</code></pre></div></td></tr></table></div>
<p>Other more advanced scenarios can be implemented to retry the transmission in case of a retryable failure,
or batch multiple outgoing messages to a single send operation.</p>
<h3 id="outgoing-message-builder">Outgoing <code>Message</code> Builder</h3>
<p>In order to convey all attributes of the outgoing message to the client library
connectors provide outgoing <code>Message</code> implementation and a corresponding outgoing message metadata.
These allow the application developer to build the message attributes that will be sent to the broker.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span>
<span class="normal"><a href="#__codelineno-11-51">51</a></span>
<span class="normal"><a href="#__codelineno-11-52">52</a></span>
<span class="normal"><a href="#__codelineno-11-53">53</a></span>
<span class="normal"><a href="#__codelineno-11-54">54</a></span>
<span class="normal"><a href="#__codelineno-11-55">55</a></span>
<span class="normal"><a href="#__codelineno-11-56">56</a></span>
<span class="normal"><a href="#__codelineno-11-57">57</a></span>
<span class="normal"><a href="#__codelineno-11-58">58</a></span>
<span class="normal"><a href="#__codelineno-11-59">59</a></span>
<span class="normal"><a href="#__codelineno-11-60">60</a></span>
<span class="normal"><a href="#__codelineno-11-61">61</a></span>
<span class="normal"><a href="#__codelineno-11-62">62</a></span>
<span class="normal"><a href="#__codelineno-11-63">63</a></span>
<span class="normal"><a href="#__codelineno-11-64">64</a></span>
<span class="normal"><a href="#__codelineno-11-65">65</a></span>
<span class="normal"><a href="#__codelineno-11-66">66</a></span>
<span class="normal"><a href="#__codelineno-11-67">67</a></span>
<span class="normal"><a href="#__codelineno-11-68">68</a></span>
<span class="normal"><a href="#__codelineno-11-69">69</a></span>
<span class="normal"><a href="#__codelineno-11-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletionStage</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.function.Function</span><span class="p">;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Message</span><span class="p">;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Metadata</span><span class="p">;</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.locals.ContextAwareMessage</span><span class="p">;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyOutgoingMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">ContextAwareMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="n">metadata</span><span class="p">;</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ack</span><span class="p">;</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Throwable</span><span class="p">,</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">nack</span><span class="p">;</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyOutgoingMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">Message</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyOutgoingMessage</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getPayload</span><span class="p">(),</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getMetadata</span><span class="p">(),</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getAck</span><span class="p">(),</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getNack</span><span class="p">());</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyOutgoingMessage</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="n">metadata</span><span class="p">,</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="w">            </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ack</span><span class="p">,</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a><span class="w">            </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Throwable</span><span class="p">,</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">nack</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metadata</span><span class="p">;</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">ack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ack</span><span class="p">;</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nack</span><span class="p">;</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyOutgoingMessage</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a><span class="w">            </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ack</span><span class="p">,</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a><span class="w">            </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Throwable</span><span class="p">,</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">nack</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a><span class="w">        </span><span class="k">this</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyOutgoingMetadata</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">)),</span><span class="w"> </span><span class="n">ack</span><span class="p">,</span><span class="w"> </span><span class="n">nack</span><span class="p">);</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getPayload</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a>
<a id="__codelineno-11-44" name="__codelineno-11-44"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-11-45" name="__codelineno-11-45"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="nf">getMetadata</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-46" name="__codelineno-11-46"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">metadata</span><span class="p">;</span>
<a id="__codelineno-11-47" name="__codelineno-11-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-48" name="__codelineno-11-48"></a>
<a id="__codelineno-11-49" name="__codelineno-11-49"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getAck</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-51" name="__codelineno-11-51"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">ack</span><span class="p">;</span>
<a id="__codelineno-11-52" name="__codelineno-11-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-53" name="__codelineno-11-53"></a>
<a id="__codelineno-11-54" name="__codelineno-11-54"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-11-55" name="__codelineno-11-55"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Throwable</span><span class="p">,</span><span class="w"> </span><span class="n">CompletionStage</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getNack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-56" name="__codelineno-11-56"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">nack</span><span class="p">;</span>
<a id="__codelineno-11-57" name="__codelineno-11-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-58" name="__codelineno-11-58"></a>
<a id="__codelineno-11-59" name="__codelineno-11-59"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MyOutgoingMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">withKey</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-60" name="__codelineno-11-60"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">metadata</span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">metadata</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">MyOutgoingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-11-61" name="__codelineno-11-61"></a><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">MyOutgoingMetadata</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">m</span><span class="p">).</span><span class="na">withKey</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">build</span><span class="p">()));</span>
<a id="__codelineno-11-62" name="__codelineno-11-62"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-11-63" name="__codelineno-11-63"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-64" name="__codelineno-11-64"></a>
<a id="__codelineno-11-65" name="__codelineno-11-65"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MyOutgoingMessage</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">withTopic</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-66" name="__codelineno-11-66"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">metadata</span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">metadata</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">MyOutgoingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-11-67" name="__codelineno-11-67"></a><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">MyOutgoingMetadata</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">m</span><span class="p">).</span><span class="na">withTopic</span><span class="p">(</span><span class="n">topic</span><span class="p">).</span><span class="na">build</span><span class="p">()));</span>
<a id="__codelineno-11-68" name="__codelineno-11-68"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-11-69" name="__codelineno-11-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-70" name="__codelineno-11-70"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span>
<span class="normal"><a href="#__codelineno-12-51">51</a></span>
<span class="normal"><a href="#__codelineno-12-52">52</a></span>
<span class="normal"><a href="#__codelineno-12-53">53</a></span>
<span class="normal"><a href="#__codelineno-12-54">54</a></span>
<span class="normal"><a href="#__codelineno-12-55">55</a></span>
<span class="normal"><a href="#__codelineno-12-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors</span><span class="p">;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyOutgoingMetadata</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyOutgoingMetadataBuilder</span><span class="w"> </span><span class="nf">builder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyOutgoingMetadataBuilder</span><span class="p">();</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyOutgoingMetadataBuilder</span><span class="w"> </span><span class="nf">builder</span><span class="p">(</span><span class="n">MyOutgoingMetadata</span><span class="w"> </span><span class="n">metadata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyOutgoingMetadataBuilder</span><span class="p">(</span><span class="n">metadata</span><span class="p">);</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyOutgoingMetadata</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTopic</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyOutgoingMetadataBuilder</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyOutgoingMetadataBuilder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyOutgoingMetadataBuilder</span><span class="p">(</span><span class="n">MyOutgoingMetadata</span><span class="w"> </span><span class="n">metadata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metadata</span><span class="p">.</span><span class="na">getKey</span><span class="p">();</span>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metadata</span><span class="p">.</span><span class="na">getTopic</span><span class="p">();</span>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">MyOutgoingMetadataBuilder</span><span class="w"> </span><span class="nf">withTopic</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topic</span><span class="p">;</span>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-12-45" name="__codelineno-12-45"></a>
<a id="__codelineno-12-46" name="__codelineno-12-46"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">MyOutgoingMetadataBuilder</span><span class="w"> </span><span class="nf">withKey</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-47" name="__codelineno-12-47"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-12-48" name="__codelineno-12-48"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-12-49" name="__codelineno-12-49"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-12-50" name="__codelineno-12-50"></a>
<a id="__codelineno-12-51" name="__codelineno-12-51"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">MyOutgoingMetadata</span><span class="w"> </span><span class="nf">build</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-52" name="__codelineno-12-52"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyOutgoingMetadata</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-12-53" name="__codelineno-12-53"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-12-54" name="__codelineno-12-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-55" name="__codelineno-12-55"></a>
<a id="__codelineno-12-56" name="__codelineno-12-56"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The outgoing channel implementation then will construct the client library object that represents the outbound message, <code>SendMessage</code> in this example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">publishMessage</span><span class="p">(</span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="c1">// construct the outgoing message</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="n">SendMessage</span><span class="w"> </span><span class="n">sendMessage</span><span class="p">;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getPayload</span><span class="p">();</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payload</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">SendMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">        </span><span class="n">sendMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SendMessage</span><span class="p">)</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getPayload</span><span class="p">();</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">        </span><span class="n">sendMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SendMessage</span><span class="p">();</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setPayload</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setTopic</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">        </span><span class="n">message</span><span class="p">.</span><span class="na">getMetadata</span><span class="p">(</span><span class="n">MyOutgoingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">            </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setTopic</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="na">getTopic</span><span class="p">());</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">            </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setKey</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="na">getKey</span><span class="p">());</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">            </span><span class="c1">//...</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">sendMessage</span><span class="p">))</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="w">            </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">transformToUni</span><span class="p">(</span><span class="n">receipt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">ack</span><span class="p">()))</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="w">            </span><span class="p">.</span><span class="na">onFailure</span><span class="p">().</span><span class="na">recoverWithUni</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">nack</span><span class="p">(</span><span class="n">t</span><span class="p">)));</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>It is a best practice to also allow the application to return a payload of the client outbound library object (<code>SendMessage</code>).</p>
<h3 id="outgoing-message-acknowledgement">Outgoing message acknowledgement</h3>
<p>Because the Reactive Messaging <a href="../acknowledgement/#chain-of-acknowledgment">chains acknowledgements</a> from incoming message until the outgoing message,
it is crucial for the outgoing channel to correctly ack and nack the message.</p>
<h2 id="smallrye-health-integration">Smallrye Health Integration</h2>
<p>Smallrye Reactive Messaging allows connectors to integrate with Smallrye Health to contribute channel state to the health reports.
Connectors need to implement the <code>HealthReporter</code> interface and implement some or all of the <code>getReadiness</code>, <code>getLiveness</code> and <code>getStartup</code> methods:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span>
<span class="normal"><a href="#__codelineno-14-40">40</a></span>
<span class="normal"><a href="#__codelineno-14-41">41</a></span>
<span class="normal"><a href="#__codelineno-14-42">42</a></span>
<span class="normal"><a href="#__codelineno-14-43">43</a></span>
<span class="normal"><a href="#__codelineno-14-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nd">@ApplicationScoped</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="nd">@Connector</span><span class="p">(</span><span class="n">MyConnectorWithPartials</span><span class="p">.</span><span class="na">CONNECTOR_NAME</span><span class="p">)</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyConnectorWithPartials</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">InboundConnector</span><span class="p">,</span><span class="w"> </span><span class="n">OutboundConnector</span><span class="p">,</span><span class="w"> </span><span class="n">HealthReporter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">CONNECTOR_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;smallrye-my-connector&quot;</span><span class="p">;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MyIncomingChannel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">incomingChannels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MyOutgoingChannel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">outgoingChannels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">HealthReport</span><span class="w"> </span><span class="nf">getReadiness</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">        </span><span class="n">HealthReport</span><span class="p">.</span><span class="na">HealthReportBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HealthReport</span><span class="p">.</span><span class="na">builder</span><span class="p">();</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">MyIncomingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">incomingChannels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">.</span><span class="na">getChannel</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">MyOutgoingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">outgoingChannels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">.</span><span class="na">getChannel</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">HealthReport</span><span class="w"> </span><span class="nf">getLiveness</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="w">        </span><span class="n">HealthReport</span><span class="p">.</span><span class="na">HealthReportBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HealthReport</span><span class="p">.</span><span class="na">builder</span><span class="p">();</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">MyIncomingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">incomingChannels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">.</span><span class="na">getChannel</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">MyOutgoingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">outgoingChannels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">.</span><span class="na">getChannel</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">HealthReport</span><span class="w"> </span><span class="nf">getStartup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a><span class="w">        </span><span class="n">HealthReport</span><span class="p">.</span><span class="na">HealthReportBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HealthReport</span><span class="p">.</span><span class="na">builder</span><span class="p">();</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">MyIncomingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">incomingChannels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a><span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">.</span><span class="na">getChannel</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">MyOutgoingChannel</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">outgoingChannels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a><span class="w">            </span><span class="n">builder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">channel</span><span class="p">.</span><span class="na">getChannel</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Implementing health reports per channel depends on what information is available to the connector.
For more information on different health check probes you can check out <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Configure Liveness, Readiness and Startup Probes
</a></p>
<p>You may want to add a connector attribute to enable/disable the health reporting per channel:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.annotations.ConnectorAttribute</span><span class="p">;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nd">@ConnectorAttribute</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;health-enabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConnectorAttribute</span><span class="p">.</span><span class="na">Direction</span><span class="p">.</span><span class="na">INCOMING_AND_OUTGOING</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Whether health reporting is enabled (default) or disabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="opentelemetry-tracing-integration">OpenTelemetry Tracing Integration</h2>
<p>Smallrye Reactive Messaging allows connectors to easily integrate with OpenTelemetry tracing.
It propagates the tracing context from inbound messages and to outbound messages.
The <code>smallrye-reactive-messaging-otel</code> module provides necessary dependencies to the OpenTelemetry artifacts and also provides <code>TracingUtils</code> helper class for setting up the tracing.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>io.smallrye.reactive.messaging<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>smallrye-reactive-messaging-otel<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>For integrating tracing you'd need to create a couple of classes:</p>
<ul>
<li>Holder class for tracing information</li>
<li>Implementation of <code>io.opentelemetry.context.propagation.TextMapGetter</code>, which retrieves for a given key the value of a tracing attributed from the holder object</li>
<li>Implementation of <code>io.opentelemetry.context.propagation.TextMapSetter</code>, which sets on the holder object the key and value of tracing attributes</li>
<li>Implementations of <code>io.opentelemetry.instrumentation.api.instrumenter.AttributesExtractor</code> and <code>io.opentelemetry.instrumentation.api.instrumenter.messaging.MessagingAttributesGetter</code></li>
</ul>
<p>Then you'd need to configure instrumenters per incoming and outgoing channel:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Instrumenter</span><span class="o">&lt;</span><span class="n">MyTrace</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createInstrumenter</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">incoming</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">        </span><span class="n">MessageOperation</span><span class="w"> </span><span class="n">messageOperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">MessageOperation</span><span class="p">.</span><span class="na">RECEIVE</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MessageOperation</span><span class="p">.</span><span class="na">PUBLISH</span><span class="p">;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">        </span><span class="n">MyAttributesExtractor</span><span class="w"> </span><span class="n">myExtractor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyAttributesExtractor</span><span class="p">();</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">        </span><span class="n">MessagingAttributesGetter</span><span class="o">&lt;</span><span class="n">MyTrace</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">attributesGetter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myExtractor</span><span class="p">.</span><span class="na">getMessagingAttributesGetter</span><span class="p">();</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">spanNameExtractor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessagingSpanNameExtractor</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">attributesGetter</span><span class="p">,</span><span class="w"> </span><span class="n">messageOperation</span><span class="p">);</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">        </span><span class="n">InstrumenterBuilder</span><span class="o">&lt;</span><span class="n">MyTrace</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instrumenter</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="n">GlobalOpenTelemetry</span><span class="p">.</span><span class="na">get</span><span class="p">(),</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">                </span><span class="s">&quot;io.smallrye.reactive.messaging&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">spanNameExtractor</span><span class="p">);</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">attributesExtractor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessagingAttributesExtractor</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">attributesGetter</span><span class="p">,</span><span class="w"> </span><span class="n">messageOperation</span><span class="p">);</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">        </span><span class="n">builder</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">                </span><span class="p">.</span><span class="na">addAttributesExtractor</span><span class="p">(</span><span class="n">attributesExtractor</span><span class="p">)</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">                </span><span class="p">.</span><span class="na">addAttributesExtractor</span><span class="p">(</span><span class="n">myExtractor</span><span class="p">);</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">incoming</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">buildConsumerInstrumenter</span><span class="p">(</span><span class="n">MyTraceTextMapGetter</span><span class="p">.</span><span class="na">INSTANCE</span><span class="p">);</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">buildProducerInstrumenter</span><span class="p">(</span><span class="n">MyTraceTextMapSetter</span><span class="p">.</span><span class="na">INSTANCE</span><span class="p">);</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">    </span><span class="c1">// &lt;/create-instrumener&gt;</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">traceIncoming</span><span class="p">(</span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">MyTrace</span><span class="w"> </span><span class="n">myTrace</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">makeCurrent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TracingUtils</span><span class="p">.</span><span class="na">traceIncoming</span><span class="p">(</span><span class="n">instrumenter</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">myTrace</span><span class="p">,</span><span class="w"> </span><span class="n">makeCurrent</span><span class="p">);</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">traceOutgoing</span><span class="p">(</span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">MyTrace</span><span class="w"> </span><span class="n">myTrace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a><span class="w">        </span><span class="n">TracingUtils</span><span class="p">.</span><span class="na">traceOutgoing</span><span class="p">(</span><span class="n">instrumenter</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">myTrace</span><span class="p">);</span>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finally, you'd need to configure instrumenters per incoming and outgoing channels and wire the call to instrumenter using <code>TracingUtils</code>.</p>
<p>For an incoming channel, you'd need to call the instrumenter on an inbound message:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">Multi</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">receiveMulti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Multi</span><span class="p">.</span><span class="na">createBy</span><span class="p">().</span><span class="na">repeating</span><span class="p">()</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">        </span><span class="p">.</span><span class="na">uni</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">client</span><span class="p">.</span><span class="na">poll</span><span class="p">()))</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">        </span><span class="p">.</span><span class="na">until</span><span class="p">(</span><span class="n">__</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">closed</span><span class="p">.</span><span class="na">get</span><span class="p">())</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">        </span><span class="p">.</span><span class="na">emitOn</span><span class="p">(</span><span class="n">context</span><span class="p">::</span><span class="n">runOnContext</span><span class="p">)</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">consumed</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyMessage</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">consumed</span><span class="p">,</span><span class="w"> </span><span class="n">ackHandler</span><span class="p">,</span><span class="w"> </span><span class="n">failureHandler</span><span class="p">));</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="n">Instrumenter</span><span class="o">&lt;</span><span class="n">MyTrace</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">instrumenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyOpenTelemetryInstrumenter</span><span class="p">.</span><span class="na">createInstrumenter</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tracingEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">    </span><span class="n">receiveMulti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">receiveMulti</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">        </span><span class="n">ConsumedMessage</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">consumedMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getMetadata</span><span class="p">(</span><span class="n">MyIncomingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">get</span><span class="p">().</span><span class="na">getCustomMessage</span><span class="p">();</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TracingUtils</span><span class="p">.</span><span class="na">traceIncoming</span><span class="p">(</span><span class="n">instrumenter</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyTrace</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">                </span><span class="p">.</span><span class="na">withClientId</span><span class="p">(</span><span class="n">consumedMessage</span><span class="p">.</span><span class="na">clientId</span><span class="p">())</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">                </span><span class="p">.</span><span class="na">withTopic</span><span class="p">(</span><span class="n">consumedMessage</span><span class="p">.</span><span class="na">topic</span><span class="p">())</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">                </span><span class="p">.</span><span class="na">withProperties</span><span class="p">(</span><span class="n">consumedMessage</span><span class="p">.</span><span class="na">properties</span><span class="p">())</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>For an outgoing channel, you'd need to call the instrumenter on constructing the outbound message:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">publishMessageWithTracing</span><span class="p">(</span><span class="n">BrokerClient</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="c1">// construct the outgoing message</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="n">SendMessage</span><span class="w"> </span><span class="n">sendMessage</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getPayload</span><span class="p">();</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payload</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">SendMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">        </span><span class="n">sendMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SendMessage</span><span class="p">)</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getPayload</span><span class="p">();</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">        </span><span class="n">sendMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SendMessage</span><span class="p">();</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setPayload</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setTopic</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">        </span><span class="n">message</span><span class="p">.</span><span class="na">getMetadata</span><span class="p">(</span><span class="n">MyOutgoingMetadata</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">            </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setTopic</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="na">getTopic</span><span class="p">());</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="w">            </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setKey</span><span class="p">(</span><span class="n">out</span><span class="p">.</span><span class="na">getKey</span><span class="p">());</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">            </span><span class="c1">//...</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tracingEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">        </span><span class="n">TracingUtils</span><span class="p">.</span><span class="na">traceOutgoing</span><span class="p">(</span><span class="n">instrumenter</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyTrace</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="w">                </span><span class="p">.</span><span class="na">withProperties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="w">                </span><span class="p">.</span><span class="na">withTopic</span><span class="p">(</span><span class="n">sendMessage</span><span class="p">.</span><span class="na">getTopic</span><span class="p">())</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">.</span><span class="na">setProperties</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">sendMessage</span><span class="p">))</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="w">            </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">transformToUni</span><span class="p">(</span><span class="n">receipt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">ack</span><span class="p">()))</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">            </span><span class="p">.</span><span class="na">onFailure</span><span class="p">().</span><span class="na">recoverWithUni</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">().</span><span class="na">completionStage</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">nack</span><span class="p">(</span><span class="n">t</span><span class="p">)));</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>You may want to add a connector attribute to enable/disable the tracing per channel:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.annotations.ConnectorAttribute</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="nd">@ConnectorAttribute</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tracing-enabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConnectorAttribute</span><span class="p">.</span><span class="na">Direction</span><span class="p">.</span><span class="na">INCOMING_AND_OUTGOING</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Whether tracing is enabled (default) or disabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="testing-the-connector">Testing the connector</h2>
<p>While unit tests are highly encouraged for validating ad-hoc logic in connector code,
by nature connector tests are mostly integration tests validating the correct configuration and functioning of channels.
Most of the time tests need to run against a broker instance.
This instance can be mocked or embedded in the test JVM,
or provisioned in a container runtime using <a href="https://testcontainers.org">Testcontainers</a>.
The testcontainers approach is encouraged as it'll provide a testing environment closest to reality.</p>
<p>It may take too much time and resources to start a broker per test method or per test class,
so may want to share the same broker instance between all test classes.
In that case you can checkout how to write a <a href="https://junit.org/junit5/docs/current/user-guide/#extensions">JUnit 5 Extension</a>
and start only one container instance in the beginning of tests and stop it at the end of all the tests.</p>
<p>There are essentially two ways of creating the connector behavior to test against:</p>
<ol>
<li>Instantiating channels directly by passing the custom configuration.
With this you can get the Reactive stream directly from the channel implementation and send/receive messages.
You can use <a href="https://smallrye.io/smallrye-mutiny/2.5.1/guides/testing/">AssertSubscriber from Mutiny</a> to regulate demand and write assertions.</li>
<li>CDI-based tests which write configuration and instantiate application beans.
You can use <a href="https://weld.cdi-spec.org/">Weld, the reference implementation of CDI specification</a> with configured set of beans and extensions:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">  1</a></span>
<span class="normal"><a href="#__codelineno-21-2">  2</a></span>
<span class="normal"><a href="#__codelineno-21-3">  3</a></span>
<span class="normal"><a href="#__codelineno-21-4">  4</a></span>
<span class="normal"><a href="#__codelineno-21-5">  5</a></span>
<span class="normal"><a href="#__codelineno-21-6">  6</a></span>
<span class="normal"><a href="#__codelineno-21-7">  7</a></span>
<span class="normal"><a href="#__codelineno-21-8">  8</a></span>
<span class="normal"><a href="#__codelineno-21-9">  9</a></span>
<span class="normal"><a href="#__codelineno-21-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-21-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-21-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-21-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-21-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-21-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-21-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-21-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-21-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-21-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-21-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-21-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-21-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-21-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-21-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-21-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-21-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-21-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-21-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-21-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-21-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-21-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-21-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-21-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-21-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-21-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-21-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-21-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-21-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-21-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-21-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-21-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-21-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-21-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-21-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-21-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-21-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-21-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-21-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-21-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-21-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-21-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-21-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-21-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-21-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-21-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-21-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-21-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-21-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-21-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-21-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-21-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-21-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-21-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-21-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-21-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-21-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-21-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-21-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-21-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-21-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-21-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-21-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-21-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-21-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-21-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-21-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-21-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-21-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-21-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-21-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-21-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-21-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-21-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-21-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-21-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-21-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-21-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-21-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-21-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-21-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-21-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-21-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-21-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-21-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-21-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-21-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-21-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-21-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-21-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-21-100">100</a></span>
<span class="normal"><a href="#__codelineno-21-101">101</a></span>
<span class="normal"><a href="#__codelineno-21-102">102</a></span>
<span class="normal"><a href="#__codelineno-21-103">103</a></span>
<span class="normal"><a href="#__codelineno-21-104">104</a></span>
<span class="normal"><a href="#__codelineno-21-105">105</a></span>
<span class="normal"><a href="#__codelineno-21-106">106</a></span>
<span class="normal"><a href="#__codelineno-21-107">107</a></span>
<span class="normal"><a href="#__codelineno-21-108">108</a></span>
<span class="normal"><a href="#__codelineno-21-109">109</a></span>
<span class="normal"><a href="#__codelineno-21-110">110</a></span>
<span class="normal"><a href="#__codelineno-21-111">111</a></span>
<span class="normal"><a href="#__codelineno-21-112">112</a></span>
<span class="normal"><a href="#__codelineno-21-113">113</a></span>
<span class="normal"><a href="#__codelineno-21-114">114</a></span>
<span class="normal"><a href="#__codelineno-21-115">115</a></span>
<span class="normal"><a href="#__codelineno-21-116">116</a></span>
<span class="normal"><a href="#__codelineno-21-117">117</a></span>
<span class="normal"><a href="#__codelineno-21-118">118</a></span>
<span class="normal"><a href="#__codelineno-21-119">119</a></span>
<span class="normal"><a href="#__codelineno-21-120">120</a></span>
<span class="normal"><a href="#__codelineno-21-121">121</a></span>
<span class="normal"><a href="#__codelineno-21-122">122</a></span>
<span class="normal"><a href="#__codelineno-21-123">123</a></span>
<span class="normal"><a href="#__codelineno-21-124">124</a></span>
<span class="normal"><a href="#__codelineno-21-125">125</a></span>
<span class="normal"><a href="#__codelineno-21-126">126</a></span>
<span class="normal"><a href="#__codelineno-21-127">127</a></span>
<span class="normal"><a href="#__codelineno-21-128">128</a></span>
<span class="normal"><a href="#__codelineno-21-129">129</a></span>
<span class="normal"><a href="#__codelineno-21-130">130</a></span>
<span class="normal"><a href="#__codelineno-21-131">131</a></span>
<span class="normal"><a href="#__codelineno-21-132">132</a></span>
<span class="normal"><a href="#__codelineno-21-133">133</a></span>
<span class="normal"><a href="#__codelineno-21-134">134</a></span>
<span class="normal"><a href="#__codelineno-21-135">135</a></span>
<span class="normal"><a href="#__codelineno-21-136">136</a></span>
<span class="normal"><a href="#__codelineno-21-137">137</a></span>
<span class="normal"><a href="#__codelineno-21-138">138</a></span>
<span class="normal"><a href="#__codelineno-21-139">139</a></span>
<span class="normal"><a href="#__codelineno-21-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors.test</span><span class="p">;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.inject.spi.BeanManager</span><span class="p">;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.config.ConfigProvider</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.spi.ConnectorLiteral</span><span class="p">;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.weld.environment.se.Weld</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.weld.environment.se.WeldContainer</span><span class="p">;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.AfterEach</span><span class="p">;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.BeforeEach</span><span class="p">;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.MyConnector</span><span class="p">;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.MyMessageConverter</span><span class="p">;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.config.SmallRyeConfigProviderResolver</span><span class="p">;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.config.inject.ConfigExtension</span><span class="p">;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.MediatorFactory</span><span class="p">;</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.connectors.ExecutionHolder</span><span class="p">;</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.connectors.WorkerPoolRegistry</span><span class="p">;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.extension.ChannelProducer</span><span class="p">;</span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.extension.EmitterFactoryImpl</span><span class="p">;</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.extension.HealthCenter</span><span class="p">;</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.extension.LegacyEmitterFactoryImpl</span><span class="p">;</span>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.extension.MediatorManager</span><span class="p">;</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.extension.MutinyEmitterFactoryImpl</span><span class="p">;</span>
<a id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.extension.ReactiveMessagingExtension</span><span class="p">;</span>
<a id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.impl.ConfiguredChannelFactory</span><span class="p">;</span>
<a id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.impl.ConnectorFactories</span><span class="p">;</span>
<a id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.impl.InternalChannelRegistry</span><span class="p">;</span>
<a id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.metrics.MetricDecorator</span><span class="p">;</span>
<a id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.metrics.MicrometerDecorator</span><span class="p">;</span>
<a id="__codelineno-21-31" name="__codelineno-21-31"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.providers.wiring.Wiring</span><span class="p">;</span>
<a id="__codelineno-21-32" name="__codelineno-21-32"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.test.common.config.MapBasedConfig</span><span class="p">;</span>
<a id="__codelineno-21-33" name="__codelineno-21-33"></a>
<a id="__codelineno-21-34" name="__codelineno-21-34"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WeldTestBase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-35" name="__codelineno-21-35"></a>
<a id="__codelineno-21-36" name="__codelineno-21-36"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">Weld</span><span class="w"> </span><span class="n">weld</span><span class="p">;</span>
<a id="__codelineno-21-37" name="__codelineno-21-37"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">WeldContainer</span><span class="w"> </span><span class="n">container</span><span class="p">;</span>
<a id="__codelineno-21-38" name="__codelineno-21-38"></a>
<a id="__codelineno-21-39" name="__codelineno-21-39"></a><span class="w">    </span><span class="nd">@BeforeEach</span>
<a id="__codelineno-21-40" name="__codelineno-21-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initWeld</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-41" name="__codelineno-21-41"></a><span class="w">        </span><span class="n">weld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Weld</span><span class="p">();</span>
<a id="__codelineno-21-42" name="__codelineno-21-42"></a>
<a id="__codelineno-21-43" name="__codelineno-21-43"></a><span class="w">        </span><span class="c1">// SmallRye config</span>
<a id="__codelineno-21-44" name="__codelineno-21-44"></a><span class="w">        </span><span class="n">ConfigExtension</span><span class="w"> </span><span class="n">extension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConfigExtension</span><span class="p">();</span>
<a id="__codelineno-21-45" name="__codelineno-21-45"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addExtension</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
<a id="__codelineno-21-46" name="__codelineno-21-46"></a>
<a id="__codelineno-21-47" name="__codelineno-21-47"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">MediatorFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-48" name="__codelineno-21-48"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">MediatorManager</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-49" name="__codelineno-21-49"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">InternalChannelRegistry</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-50" name="__codelineno-21-50"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">ConnectorFactories</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-51" name="__codelineno-21-51"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">ConfiguredChannelFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-52" name="__codelineno-21-52"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">ChannelProducer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-53" name="__codelineno-21-53"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">ExecutionHolder</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-54" name="__codelineno-21-54"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">WorkerPoolRegistry</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-55" name="__codelineno-21-55"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">HealthCenter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-56" name="__codelineno-21-56"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">Wiring</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-57" name="__codelineno-21-57"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addExtension</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ReactiveMessagingExtension</span><span class="p">());</span>
<a id="__codelineno-21-58" name="__codelineno-21-58"></a>
<a id="__codelineno-21-59" name="__codelineno-21-59"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">EmitterFactoryImpl</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-60" name="__codelineno-21-60"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">MutinyEmitterFactoryImpl</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-61" name="__codelineno-21-61"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">LegacyEmitterFactoryImpl</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-62" name="__codelineno-21-62"></a>
<a id="__codelineno-21-63" name="__codelineno-21-63"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">MyConnector</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-64" name="__codelineno-21-64"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">MyMessageConverter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-65" name="__codelineno-21-65"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">MetricDecorator</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-66" name="__codelineno-21-66"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">MicrometerDecorator</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-21-67" name="__codelineno-21-67"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">disableDiscovery</span><span class="p">();</span>
<a id="__codelineno-21-68" name="__codelineno-21-68"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-69" name="__codelineno-21-69"></a>
<a id="__codelineno-21-70" name="__codelineno-21-70"></a><span class="w">    </span><span class="nd">@AfterEach</span>
<a id="__codelineno-21-71" name="__codelineno-21-71"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stopContainer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-72" name="__codelineno-21-72"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">container</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-73" name="__codelineno-21-73"></a><span class="w">            </span><span class="c1">// TODO Explicitly close the connector</span>
<a id="__codelineno-21-74" name="__codelineno-21-74"></a><span class="w">            </span><span class="n">getBeanManager</span><span class="p">().</span><span class="na">createInstance</span><span class="p">()</span>
<a id="__codelineno-21-75" name="__codelineno-21-75"></a><span class="w">                    </span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">MyConnector</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectorLiteral</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">MyConnector</span><span class="p">.</span><span class="na">CONNECTOR_NAME</span><span class="p">)).</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-21-76" name="__codelineno-21-76"></a><span class="w">            </span><span class="n">container</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-21-77" name="__codelineno-21-77"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-78" name="__codelineno-21-78"></a><span class="w">        </span><span class="c1">// Release the config objects</span>
<a id="__codelineno-21-79" name="__codelineno-21-79"></a><span class="w">        </span><span class="n">SmallRyeConfigProviderResolver</span><span class="p">.</span><span class="na">instance</span><span class="p">().</span><span class="na">releaseConfig</span><span class="p">(</span><span class="n">ConfigProvider</span><span class="p">.</span><span class="na">getConfig</span><span class="p">());</span>
<a id="__codelineno-21-80" name="__codelineno-21-80"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-81" name="__codelineno-21-81"></a>
<a id="__codelineno-21-82" name="__codelineno-21-82"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BeanManager</span><span class="w"> </span><span class="nf">getBeanManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-83" name="__codelineno-21-83"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">container</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-84" name="__codelineno-21-84"></a><span class="w">            </span><span class="n">runApplication</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MapBasedConfig</span><span class="p">());</span>
<a id="__codelineno-21-85" name="__codelineno-21-85"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-86" name="__codelineno-21-86"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="na">getBeanManager</span><span class="p">();</span>
<a id="__codelineno-21-87" name="__codelineno-21-87"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-88" name="__codelineno-21-88"></a>
<a id="__codelineno-21-89" name="__codelineno-21-89"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addBeans</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="p">...</span><span class="w"> </span><span class="n">clazzes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-90" name="__codelineno-21-90"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClasses</span><span class="p">(</span><span class="n">clazzes</span><span class="p">);</span>
<a id="__codelineno-21-91" name="__codelineno-21-91"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-92" name="__codelineno-21-92"></a>
<a id="__codelineno-21-93" name="__codelineno-21-93"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-94" name="__codelineno-21-94"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getBeanManager</span><span class="p">().</span><span class="na">createInstance</span><span class="p">().</span><span class="na">select</span><span class="p">(</span><span class="n">clazz</span><span class="p">).</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-21-95" name="__codelineno-21-95"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-96" name="__codelineno-21-96"></a>
<a id="__codelineno-21-97" name="__codelineno-21-97"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">runApplication</span><span class="p">(</span><span class="n">MapBasedConfig</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-98" name="__codelineno-21-98"></a><span class="w">        </span><span class="n">weld</span><span class="p">.</span><span class="na">addBeanClass</span><span class="p">(</span><span class="n">clazz</span><span class="p">);</span>
<a id="__codelineno-21-99" name="__codelineno-21-99"></a><span class="w">        </span><span class="n">runApplication</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<a id="__codelineno-21-100" name="__codelineno-21-100"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">clazz</span><span class="p">);</span>
<a id="__codelineno-21-101" name="__codelineno-21-101"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-102" name="__codelineno-21-102"></a>
<a id="__codelineno-21-103" name="__codelineno-21-103"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">runApplication</span><span class="p">(</span><span class="n">MapBasedConfig</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-104" name="__codelineno-21-104"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-105" name="__codelineno-21-105"></a><span class="w">            </span><span class="n">config</span><span class="p">.</span><span class="na">write</span><span class="p">();</span>
<a id="__codelineno-21-106" name="__codelineno-21-106"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-107" name="__codelineno-21-107"></a><span class="w">            </span><span class="n">MapBasedConfig</span><span class="p">.</span><span class="na">cleanup</span><span class="p">();</span>
<a id="__codelineno-21-108" name="__codelineno-21-108"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-109" name="__codelineno-21-109"></a>
<a id="__codelineno-21-110" name="__codelineno-21-110"></a><span class="w">        </span><span class="n">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weld</span><span class="p">.</span><span class="na">initialize</span><span class="p">();</span>
<a id="__codelineno-21-111" name="__codelineno-21-111"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-112" name="__codelineno-21-112"></a>
<a id="__codelineno-21-113" name="__codelineno-21-113"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addConfig</span><span class="p">(</span><span class="n">MapBasedConfig</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-114" name="__codelineno-21-114"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-115" name="__codelineno-21-115"></a><span class="w">            </span><span class="n">config</span><span class="p">.</span><span class="na">write</span><span class="p">();</span>
<a id="__codelineno-21-116" name="__codelineno-21-116"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-117" name="__codelineno-21-117"></a><span class="w">            </span><span class="n">MapBasedConfig</span><span class="p">.</span><span class="na">cleanup</span><span class="p">();</span>
<a id="__codelineno-21-118" name="__codelineno-21-118"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-119" name="__codelineno-21-119"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-120" name="__codelineno-21-120"></a>
<a id="__codelineno-21-121" name="__codelineno-21-121"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">HealthCenter</span><span class="w"> </span><span class="nf">getHealth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-122" name="__codelineno-21-122"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">container</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-123" name="__codelineno-21-123"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Application not started&quot;</span><span class="p">);</span>
<a id="__codelineno-21-124" name="__codelineno-21-124"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-125" name="__codelineno-21-125"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="na">getBeanManager</span><span class="p">().</span><span class="na">createInstance</span><span class="p">().</span><span class="na">select</span><span class="p">(</span><span class="n">HealthCenter</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-21-126" name="__codelineno-21-126"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-127" name="__codelineno-21-127"></a>
<a id="__codelineno-21-128" name="__codelineno-21-128"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isStarted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-129" name="__codelineno-21-129"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getHealth</span><span class="p">().</span><span class="na">getStartup</span><span class="p">().</span><span class="na">isOk</span><span class="p">();</span>
<a id="__codelineno-21-130" name="__codelineno-21-130"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-131" name="__codelineno-21-131"></a>
<a id="__codelineno-21-132" name="__codelineno-21-132"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isReady</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-133" name="__codelineno-21-133"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getHealth</span><span class="p">().</span><span class="na">getReadiness</span><span class="p">().</span><span class="na">isOk</span><span class="p">();</span>
<a id="__codelineno-21-134" name="__codelineno-21-134"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-135" name="__codelineno-21-135"></a>
<a id="__codelineno-21-136" name="__codelineno-21-136"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAlive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-137" name="__codelineno-21-137"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getHealth</span><span class="p">().</span><span class="na">getLiveness</span><span class="p">().</span><span class="na">isOk</span><span class="p">();</span>
<a id="__codelineno-21-138" name="__codelineno-21-138"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-139" name="__codelineno-21-139"></a>
<a id="__codelineno-21-140" name="__codelineno-21-140"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
</ol>
<p>You would need following test dependencies for enabling Weld in tests:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>io.smallrye.reactive<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>test-common<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">      </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.jboss.weld.se<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>weld-se-shaded<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">      </span><span class="nt">&lt;version&gt;</span>${weld.version}<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">      </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.jboss.weld<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>weld-core-impl<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">      </span><span class="nt">&lt;version&gt;</span>${weld.version}<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">      </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>org.awaitility<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>awaitility<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="w">      </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div></p>
<p>Your test classes can therefore extend the <code>WeldTestBase</code> and provide configuration and application beans:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">connectors.test</span><span class="p">;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.awaitility.Awaitility.await</span><span class="p">;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CopyOnWriteArrayList</span><span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Incoming</span><span class="p">;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">connectors.MyConnector</span><span class="p">;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.reactive.messaging.test.common.config.MapBasedConfig</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyConnectorTest</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">WeldTestBase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">incomingChannel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">myTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="w">        </span><span class="n">MapBasedConfig</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MapBasedConfig</span><span class="p">()</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><span class="w">                </span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;mp.messaging.incoming.data.topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">myTopic</span><span class="p">)</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a><span class="w">                </span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;mp.messaging.incoming.data.host&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">host</span><span class="p">)</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a><span class="w">                </span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;mp.messaging.incoming.data.port&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">)</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a><span class="w">                </span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="s">&quot;mp.messaging.incoming.data.connector&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MyConnector</span><span class="p">.</span><span class="na">CONNECTOR_NAME</span><span class="p">);</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="w">        </span><span class="n">MyApp</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runApplication</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">MyApp</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a><span class="w">        </span><span class="c1">// produce expected number of messages to myTopic</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="w">        </span><span class="c1">// wait until app received</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a><span class="w">        </span><span class="n">await</span><span class="p">().</span><span class="na">until</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">received</span><span class="p">().</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected</span><span class="p">);</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a><span class="w">    </span><span class="nd">@ApplicationScoped</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyApp</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a><span class="w">        </span><span class="nd">@Incoming</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">)</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a><span class="w">            </span><span class="n">received</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">received</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">received</span><span class="p">;</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Awaitility</p>
<p>Because connector tests are usually asynchronous, <a href="https://github.com/awaitility/awaitility">awaitility</a>
provides a DSL to await on expressed assertions.</p>
</div>
<h3 id="common-tests-for-validating-the-connector">Common tests for validating the connector</h3>
<ul>
<li>Message consumption through incoming channels</li>
<li>Message producing through outgoing channels</li>
<li>Ack and failure handler strategies test</li>
<li>Message Context propagation test <code>LocalPropagationTest</code></li>
<li><code>HealthCheckTest</code></li>
<li><code>MessageConverterTest</code></li>
<li><code>TracingPropagationTest</code></li>
<li>Configuration test</li>
<li>Authentication test</li>
<li>Tests for</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Sponsored by <a href="https://www.redhat.com"><img style="vertical-align: middle; height: 2.5em;" alt="Red Hat" src="https://github.com/jbossorg/website/raw/master/docs/img/redhat_reversed.svg"/></a> <br/> <a href="https://creativecommons.org/licenses/by/3.0/">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.tracking", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
    
  </body>
</html>